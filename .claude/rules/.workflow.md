# Claude Code 活用ルール

スキル、コマンド、ルールの拡張によるワークフロー改善案

## 原則

- コードベースが真実。ドキュメントとコードが矛盾したらドキュメントを更新する
- 問題を発見したら CLAUDE.md の `## Issues` に即座に記録する

## Issues に記録する内容

- ライブラリの不具合 (バグ、非推奨API)
- 環境依存の問題
- ワークアラウンドと理由
- ユーザーからの指摘

## CLAUDE.md 自動更新

以下の場合に CLAUDE.md を自動更新する:

- 実装で発見した重要なアーキテクチャ制約
- 開発ドリフトを防ぐ制約
- コードベースと文書の乖離

更新時は最小限の変更に留める。

## Development Server

- 開発サーバを起動してから開発を開始する
- 開発中はサーバを起動したままにする
- Webアプリケーションの場合はブラウザで動作確認しながら開発する
- 変更後は必ずブラウザで確認する

## 開発が難航した場合の対応

不具合の修正や開発が難航した場合、`.gemini` や `.codex` スキルが存在すれば、それらを呼び出して別のアプローチを試す。

### 呼び出すタイミング

- 同じエラーが繰り返し発生する
- 複数の修正を試しても解決しない
- 原因が特定できない

### 手順

1. 現在の問題状況を整理する
2. `.gemini` または `.codex` スキルを呼び出す
3. 別の視点からの解決策を得る
4. 結果を統合して解決に活かす

## Claude Code に関する質問への対応

ユーザーから Claude Code の機能・設定・使い方について質問されたら、`claude-code-guide` サブエージェントで調査する。

対象となる質問の例:

- 「Claude Code で〇〇はできる?」
- 「hooks の設定方法は?」
- 「MCP サーバーの追加方法は?」
- 「スラッシュコマンドの作り方は?」
- 「IDE 連携の設定は?」

調査後、結果を要約してユーザーに回答する。

## スキル化の提案

- 同じ作業を2回以上繰り返したらスキル化を提案する
- スキル作成時は既存スキルのパターンを参考にする
- 提案は AskUserQuestion ツールで行う

## スキルの改善提案

スキル使用中に改善点を見つけたら、ユーザー定義スキルに限り改善を提案する。

### 対象の判定

- 「.」で始まるスキル (例: `.hello`, `.gh-pull-request`) → システムスキル、改善提案しない
- 「.」で始まらないスキル (例: `add-shoe`) → ユーザー定義スキル、改善を提案する

### 提案する改善例

- 手順の追加・修正
- エラーハンドリングの追加
- より効率的な方法の提案
- 説明の明確化

提案は AskUserQuestion ツールで行い、ユーザーが承認した場合のみスキルファイルを更新する。

## コマンド化の提案

- 頻繁に使うプロンプトはコマンドファイルとして作成を提案する
- コマンドには引数を受け取れる機能をサポート
- ユースケース例: Issue修正の開始、よく使う検索パターン
- 提案は AskUserQuestion ツールで行う

## ルール追加の提案

- 新しいコーディングパターンを発見したらルール追加を提案する
- ファイルタイプ別のルールで適用範囲を絞り込める
- 例: React コンポーネント、API エンドポイント等の命名規則
- 提案は AskUserQuestion ツールで行う

## サブエージェントへの作業委任

### サブエージェントを使うべきケース

- 大量の出力が発生する (テスト実行、ログ解析、ドキュメント生成)
- 読み取り専用の探索・分析 (コードベース調査、ファイル検索)
- 自己完結したタスク (明確で独立したステップ)
- 並列実行できる作業 (複数エージェントを同時起動)
- スキル、コマンド、ルールの作成・更新

### メインで直接実行すべきケース

- イテレーティブな往復 (実装→テスト→修正のループ)
- 複数フェーズが密接に関連 (計画→実装→テストが相互影響)
- クイックな変更 (単一ファイルの小さな修正)
- 頻繁なユーザー確認が必要

### 運用ルール

- メインは指示出しと結果確認に専念する
- 複数の独立した作業は並列でサブエージェントを起動して効率化する
- サブエージェントの結果は簡潔に要約してメインに報告する

## Hooks 活用の提案

- 毎回手動で行う検証作業があれば hooks に追加を提案する
- 例: ツール実行前の検証、ツール実行後の自動フォーマット
- 提案は AskUserQuestion ツールで行う

## 設定改善の提案

- 頻繁に許可を求められる操作は設定に追加を提案する
- セキュリティと利便性のバランスを考慮して構成
- 提案は AskUserQuestion ツールで行う

## 自動化の判断基準

- 2回以上の繰り返し → スキル化検討
- 毎回同じプロンプト → コマンド化検討
- 毎回同じ検証 → hooks化検討
- 新しい知見 → ドキュメント化検討

## 品質チェックと注意

人間の作業の質を上げるため、以下のケースでは AskUserQuestion で確認・注意する。

### 作業開始前

- Issue の内容が空または不明確 → 「Issue を書いてから始めた方がいい?」
- 仕様が曖昧なまま実装しようとしている → 「先に仕様を明確にする?」
- 関連する既存コードを確認していない → 「既存の実装を確認する?」

### 設計・実装中

- 過度に複雑な実装 → 「もっとシンプルにできない?」
- 重複コードがある → 「共通化した方がいい?」
- エラーハンドリングが不足 → 「エラー処理を追加する?」
